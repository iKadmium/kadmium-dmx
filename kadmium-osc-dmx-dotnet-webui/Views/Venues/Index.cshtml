@using kadmium_osc_dmx_dotnet_core
@*
    For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Venues"; 
}

<binding-context data-bind="with: selectedItem()">
    <modal-window large="true" id="modal-edit" >
        <modal-header>
            Editing <span class="item-name" data-bind="text: name"></span>
        </modal-header>
        <modal-body>
            @Html.Partial("ModalEditorStatus")
            <div class="form-horizontal" id="edit-form" data-bind="visible: !isBusy()">
                <input-label label="Name:" data-bind="validationElement: name"><input class="form-control" data-bind="value: name"></input-label>
                <input-collection name="universes">
                    <input-collection-header>Universes</input-collection-header>
                    <input-collection-body>
                        <input-collection-item label="Name">
                            <input type="text" class="form-control" data-bind="value: name">
                        </input-collection-item>
                        <input-collection-item label="Universe ID">
                            <input type="number" class="form-control" min="1" max="63999" data-bind="value: universeID">
                        </input-collection-item>
                        <input-collection-item label="Fixtures">
                            <button asp-template="edit" data-bind="click: $parent.editFixtures.bind($parent)"></button>
                        </input-collection-item>
                        <input-collection-item label="Remove">
                            <button asp-template="delete" data-bind="click: $parent.removeUniverse.bind($parent)"></button>
                        </input-collection-item>
                    </input-collection-body>
                    <input-collection-footer>
                        <button asp-template="add" data-bind="click: addUniverse"></button>
                    </input-collection-footer>
                </input-collection>
            </div>
        </modal-body>
        <modal-footer>
            @Html.Partial("ModalEditorFooter")
        </modal-footer>
    </modal-window>

    <binding-context data-bind="with: selectedUniverse">
        <modal-window large="true" id="fixtures-edit">
            <modal-header>Editing <strong>Fixtures</strong> for <span class="item-name" data-bind="text: name"></span></modal-header>
            <modal-body>
                <input-collection name="fixtures">
                    <input-collection-body>
                        <input-collection-item label="Model">
                            <select class="form-control" data-bind="value: type">
                                @foreach (string name in FileAccess.GetFixtureNames())
                                {
                                    <option>@name</option>
                                }
                            </select>
                        </input-collection-item>
                        <input-collection-item label="Channel"><input type="number" class="form-control" data-bind="value: channel" min="1" max="512"></input-collection-item>
                        <input-collection-item label="Group">
                            <select class="form-control" data-bind="value: group">
                                @foreach (var grp in MasterController.Instance.Groups.Values.OrderBy(x => x.Order))
                                {
                                    <option>@grp.Name</option>
                                }
                            </select>
                        </input-collection-item>
                        <input-collection-item label="Options">
                            <button asp-template="edit" data-bind="click: $parent.editOptions.bind($parent)"></button>
                        </input-collection-item>
                        <input-collection-item label="Remove">
                            <button asp-template="delete" data-bind="click: $parent.removeFixture.bind($parent)"></button>
                        </input-collection-item>
                    </input-collection-body>
                    <input-collection-footer>
                        <div class="dropdown">
                            <button asp-template="add" data-bind="click: addFixture"></button>
                            <button class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-cloud-upload"></span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                @foreach (string fixtureCollectionName in FileAccess.GetFixtureCollectionNames())
                                {
                                    <li><a href="#" data-bind="click: addFixtureCollection">@fixtureCollectionName</a></li>
                                }
                            </ul>
                        </div>
                    </input-collection-footer>
                </input-collection>
            </modal-body>
            <modal-footer><button class="btn btn-success" data-dismiss="modal" >OK</button></modal-footer>
        </modal-window>

        <binding-context data-bind="with: selectedFixture">
            <binding-context data-bind="with: options">
                @Html.Partial("FixtureOptionsEditor")
            </binding-context>
        </binding-context>
    </binding-context>
</binding-context>

@Html.Partial("ItemList")

@section scripts
{
    <environment names="Development">
        <script src="http://localhost:8080/venues.bundle.js"></script>
    </environment>
    <environment names="Staging,Production">
        <script src="~/js/venues.bundle.js"></script>
    </environment>
}
